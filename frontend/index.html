<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turnitin Bypass System</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🎯 Turnitin Bypass System</h1>
            <p>Sistem Bypass Detection Turnitin - Untuk Penelitian Akademik</p>
        </header>

        <!-- Step 1: Upload Files -->
        <section id="step1" class="step active">
            <h2>📁 Step 1: Upload Files</h2>
            <div class="upload-section">
                <div class="upload-box">
                    <label for="pdfFile">
                        <div class="upload-icon">📄</div>
                        <h3>PDF Turnitin (Flag File)</h3>
                        <p>Upload PDF hasil dari Turnitin</p>
                        <input type="file" id="pdfFile" accept=".pdf" />
                        <span class="file-name" id="pdfFileName">Belum ada file</span>
                    </label>
                </div>

                <div class="upload-box">
                    <label for="docxFile">
                        <div class="upload-icon">📝</div>
                        <h3>DOCX Original</h3>
                        <p>Upload file dokumen asli (.docx)</p>
                        <input type="file" id="docxFile" accept=".docx" />
                        <span class="file-name" id="docxFileName">Belum ada file</span>
                    </label>
                </div>
            </div>

            <button id="btnAnalyze" class="btn btn-primary" disabled>
                🔍 Analyze PDF & Extract Flags
            </button>
        </section>

        <!-- Step 2: Review Flags -->
        <section id="step2" class="step">
            <h2>🔍 Step 2: Review Flags & Process</h2>
            <div class="info-box">
                <p><strong>PDF File:</strong> <span id="pdfInfo">-</span></p>
                <p><strong>DOCX File:</strong> <span id="docxInfo">-</span></p>
                <p><strong>Strategi:</strong> Header-Focused (Optimal)</p>
                <p>✅ <strong>Status:</strong> Flags telah di-extract menggunakan OCR. Review dan lanjutkan ke proses.</p>
            </div>

            <div class="flags-container">
                <h3>📌 Flagged Phrases yang Ditemukan:</h3>
                <p class="help-text">Flags di bawah ini telah di-extract secara otomatis dari PDF Turnitin menggunakan ocrmypdf --force-ocr. Anda bisa mengedit, menambah, atau menghapus flags sebelum memproses.</p>
                <textarea id="flagsInput" class="flags-input" rows="15" placeholder="Contoh:
Keselamatan dan Kesehatan Kerja (K3) merupakan aspek krusial
untuk menurunkan angka kecelakaan kerja
Penelitian ini bertujuan untuk mengembangkan
...

Paste semua teks yang ter-highlight di PDF Turnitin Anda di sini."></textarea>

                <div class="action-buttons" style="margin-top: 15px;">
                    <button id="btnMatchFlags" class="btn btn-info" disabled>
                        🔎 Match Flags dengan File Original
                    </button>
                </div>

                <div class="flags-preview" id="flagsPreview" style="display:none;">
                    <h4>Preview Flags yang Akan Diproses:</h4>
                    <p><strong>Total:</strong> <span id="totalFlags">0</span> phrases</p>
                    <div id="flagsList" class="flags-list">
                        <!-- Flags will be loaded here -->
                    </div>
                </div>

                <div id="matchResults" class="match-results" style="display:none;">
                    <h4>📊 Hasil Matching Flags:</h4>
                    <div class="match-stats">
                        <div class="stat-box">
                            <span class="stat-number" id="matchTotal">0</span>
                            <span class="stat-label">Total Flags</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-number matched" id="matchMatched">0</span>
                            <span class="stat-label">Matched ✓</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-number unmatched" id="matchUnmatched">0</span>
                            <span class="stat-label">Unmatched ✗</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-number percentage" id="matchPercentage">0%</span>
                            <span class="stat-label">Match Rate</span>
                        </div>
                    </div>

                    <div class="tabs">
                        <button class="tab-btn active" data-tab="matched-tab">✅ Matched Items (<span id="matchedCount">0</span>)</button>
                        <button class="tab-btn" data-tab="unmatched-tab">❌ Unmatched Items (<span id="unmatchedCount">0</span>)</button>
                    </div>

                    <div id="matched-tab" class="tab-content active">
                        <div id="matchedList" class="flags-list">
                            <!-- Matched flags will be loaded here -->
                        </div>
                    </div>

                    <div id="unmatched-tab" class="tab-content">
                        <div id="unmatchedList" class="flags-list">
                            <!-- Unmatched flags will be loaded here -->
                        </div>
                    </div>
                </div>

                <div class="action-buttons" style="margin-top: 20px; gap: 10px;">
                    <button id="btnBypassMatched" class="btn btn-success" disabled style="flex: 1;">
                        🔄 Apply Bypass ke Matched Items (SEMUA Flagged Text)
                    </button>
                    <div style="background: #fff3cd; border: 1px solid #ffc107; padding: 10px; border-radius: 6px; font-size: 0.85em; color: #856404;">
                        <strong>⚠️ Catatan:</strong> Gunakan tombol ini untuk memodifikasi SEMUA
                        <span id="matchedCountInfo">0</span> matched items, bukan tombol "Proses" yang lama!
                    </div>
                </div>

                <div id="bypassResults" class="bypass-results" style="display:none;">
                    <h4>📝 Hasil Bypass:</h4>
                    <div class="bypass-stats">
                        <div class="stat-box">
                            <span class="stat-number" id="bypassTotal">0</span>
                            <span class="stat-label">Total Items</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-number processed" id="bypassProcessed">0</span>
                            <span class="stat-label">Items Diproses</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-number replacements" id="bypassReplacements">0</span>
                            <span class="stat-label">Total Replacements</span>
                        </div>
                    </div>
                    <div class="bypass-details">
                        <p><strong>Status:</strong> ✅ Dokumen berhasil dimodif dengan homoglyph + invisible characters</p>
                        <p><strong>Method:</strong> <span id="bypassMethod">Combined Homoglyph (95%) + Invisible Characters (40%)</span></p>
                        <div id="bypassItemsList" class="flags-list" style="margin-top: 15px;">
                            <!-- Processed items will be loaded here -->
                        </div>
                    </div>
                    <div class="action-buttons" style="margin-top: 15px;">
                        <button id="btnDownloadBypass" class="btn btn-primary">
                            📥 Download Modified Document
                        </button>
                    </div>
                </div>
            </div>

            <div class="strategy-info-box">
                <h3>✅ Strategi Bypass: Header-Focused (Optimal)</h3>
                <div class="strategy-stats">
                    <div class="strategy-stat">
                        <span class="stat-label">Homoglyph Density:</span>
                        <span class="stat-value">95%</span>
                    </div>
                    <div class="strategy-stat">
                        <span class="stat-label">Invisible Characters:</span>
                        <span class="stat-value">40%</span>
                    </div>
                    <div class="strategy-stat">
                        <span class="stat-label">Target:</span>
                        <span class="stat-value">Headers & Standard Phrases</span>
                    </div>
                    <div class="strategy-stat">
                        <span class="stat-label">Expected Result:</span>
                        <span class="stat-value"><10% Similarity</span>
                    </div>
                </div>
                <p class="help-text">Strategi terbaik dengan hasil optimal. Fokus pada header dan format wajib akademik untuk detection rate terendah.</p>
            </div>

            <div class="action-buttons">
                <button id="btnBack" class="btn btn-secondary">⬅️ Kembali</button>
                <button id="btnProcess" class="btn btn-success" disabled>▶️ Proses dengan Header-Focused</button>
            </div>
        </section>

        <!-- Step 3: Processing -->
        <section id="step3" class="step">
            <h2>⚙️ Step 3: Processing...</h2>
            <div class="loading">
                <div class="spinner"></div>
                <p id="processingStatus">Sedang memproses dokumen...</p>
            </div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
        </section>

        <!-- Step 4: Complete -->
        <section id="step4" class="step">
            <h2>✅ Step 4: Complete!</h2>
            <div class="success-box">
                <div class="success-icon">🎉</div>
                <h3>Dokumen Berhasil Diproses!</h3>
                <div class="stats">
                    <p><strong>Headers Modified:</strong> <span id="statsHeaders">-</span></p>
                    <p><strong>Phrases Modified:</strong> <span id="statsPhrases">-</span></p>
                    <p><strong>Total Modifications:</strong> <span id="statsTotal">-</span></p>
                    <p><strong>Strategy Used:</strong> <span id="statsStrategy">-</span></p>
                </div>
                <button id="btnDownload" class="btn btn-primary">📥 Download Result</button>
                <button id="btnReset" class="btn btn-secondary">🔄 Process Another Document</button>
            </div>
        </section>

        <!-- Error Display -->
        <div id="errorBox" class="error-box hidden">
            <span class="error-close">&times;</span>
            <p id="errorMessage"></p>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="loading-modal">
        <div class="loading-content">
            <div class="spinner"></div>
            <div class="loading-text">Memproses OCR PDF...</div>
            <div class="loading-subtext">Proses ini mungkin membutuhkan waktu beberapa menit tergantung ukuran PDF</div>

            <div class="loading-steps">
                <div class="loading-step completed" id="step-upload">
                    <span class="loading-step-icon">✓</span>
                    <span>Mengupload PDF ke server...</span>
                </div>
                <div class="loading-step active pulse" id="step-ocr">
                    <span class="loading-step-icon">⚙️</span>
                    <span>Menjalankan ocrmypdf --force-ocr...</span>
                </div>
                <div class="loading-step" id="step-extract">
                    <span class="loading-step-icon">⏳</span>
                    <span>Mengekstrak teks dari hasil OCR...</span>
                </div>
                <div class="loading-step" id="step-parse">
                    <span class="loading-step-icon">⏳</span>
                    <span>Parsing flagged phrases...</span>
                </div>
                <div class="loading-step" id="step-complete">
                    <span class="loading-step-icon">⏳</span>
                    <span>Menampilkan hasil...</span>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Version 1.0.0 | Untuk Penelitian Akademik | &copy; 2025</p>
    </footer>

    <script src="/static/js/app.js"></script>
</body>
</html>
